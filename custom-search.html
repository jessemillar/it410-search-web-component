<!-- Defines element markup -->
<template>
	<form action="#">
		<input type="text"/><button>Search</button>
	</form>
</template>

<script>
	(function(window, document, undefined) {
		// Refers to the "importer", which is index.html
		var parentDoc = document;

		// Refers to the "importee", which is src/custom-search.html
		var thisDoc = (parentDoc._currentScript || parentDoc.currentScript).ownerDocument;

		// Gets content from <template>
		var template = thisDoc.querySelector('template').content;

		// Creates an object based in the HTML Element prototype
		var elementPrototype = Object.create(HTMLElement.prototype);

		// Fires when an instance of the element is created
		elementPrototype.createdCallback = function() {
			// Creates the shadow root
			var shadowRoot = this.createShadowRoot();

			// Adds a template clone into shadow root
			var clone = parentDoc.importNode(template, true);
			shadowRoot.appendChild(clone);

			// Caches DOM queries
			this.input = shadowRoot.querySelector('input');
			this.button = shadowRoot.querySelector('button');

			// Listen for "Enter" presses on the input of the search field
			this.input.onkeypress = function(e) {
				if (!e) e = window.event;
				var keyCode = e.keyCode || e.which;
				if (keyCode == '13') {
					// Enter pressed
					console.log(shadowRoot.querySelector('input').value);
					return false;
				}
			}

			// Keep "value" up to date
			this.input.onkeydown = function() {
				elementPrototype.value = shadowRoot.querySelector('input').value;
			}

			// Listen for clicks on the "Search" button
			this.button.onclick = function() {
				console.log(shadowRoot.querySelector('input').value);
			}

			// Checks if the "value" attribute has been overwritten
			if (this.hasAttribute('value')) {
				var value = this.getAttribute('value');
				this.set(value);
			} else {
				this.set(this.value);
			}
		};

		// Fires when an attribute was added, removed, or updated
		elementPrototype.attributeChangedCallback = function(attr, oldVal, newVal) {
			if (attr === 'value') {
				this.set(newVal);
			}
		};

		// Sets new value of the search field
		elementPrototype.set = function(val) {
			this.input.value = val;
		};

		// Gets the value of the search field
		elementPrototype.get = function() {
			return this.input.value;
		};

		// Registers <custom-search> in the main document
		window.MyElement = parentDoc.registerElement('custom-search', {
			prototype: elementPrototype
		});
	})(window, document);
</script>
